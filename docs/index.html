<html>
    <head><meta charset="utf-8"></head>
    <body>
        <form action="/form.php" method="post">
            <div>
                <label for="myName">名前：<input id="myName" name="myName"></input></label>
                <div>ハンジ「<span id="quote">さあ今日も頑張って書いていこうか！</span>」</div>
                <textarea id="contents" name="contents" cols="80" rows="30"></textarea>
                <div><span id="currentLen"></span>文字</div>
            </div>
        </form>
    </body>
    <script>
        // セリフ更新文字数
        const REF_CNT = 10;

        // ハンジセリフ
        const HANS_QUOTES = [
            'よく頑張ってるね！',
            'すごい！',
            'できあがったらぜひ一番に私に読ませてほしいよ！',
            '頑張ってるね！{name}の頑張りを見られて嬉しいよ',
            'この文章、すっっごく滾るよ',
            '一歩一歩の積み重ねが素晴らしい作品を作るんだ',
            '{count}文字！たくさん書いたね！',
            '{count}文字も書いて疲れただろう。お疲れ様！',
            'えっ？まだ書くの？{name}は頑張り屋さんだね',
            'ねぇリヴァイ見てよ！この子もうこんなに書いたんだよ！'
        ];

        // HTML要素取得
        const contentsElem = document.getElementById('contents');
        const quoteElem = document.getElementById('quote');
        const currentLenElem = document.getElementById('currentLen');
        const myNameElem = document.getElementById('myName');
        currentLenElem.textContent = '0';

        let bfrSize = 0;
        // テキストエリア入力イベント
        contentsElem.addEventListener('input', (event) => {
            const txtData = contentsElem.value;
            currentLenElem.textContent = String(contentsElem.value.length);
            if (txtData.length - bfrSize >= REF_CNT) {
                // セリフ更新文字数を超えたらセリフを更新
                bfrSize = txtData.length;
                refreshQuote(txtData.length);
            } else if(txtData.length < bfrSize) {
                // 文字削除時は元文字数を更新する
                bfrSize = txtData.length;
            }
        });

        // セリフ更新
        function refreshQuote(len) {
            const myName = myNameElem.value.length == 0 ? 'きみ' : myNameElem.value;
            let newQuote;
            //ランダムに選ぶ
            const num = Math.floor(Math.random() * HANS_QUOTES.length);
            quoteElem.textContent = replace(HANS_QUOTES[num], {name: myName, count: String(len)});
        }

        // 置換処理
        function replace(template, replacement) {
            return template.replace(/\{(.+?)\}/g, function(m, c)
            {
                return (replacement[c] != null) ? replacement[c] : m
            });
        }
    </script>
</html>